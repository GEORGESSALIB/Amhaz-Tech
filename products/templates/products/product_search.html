{% extends "base.html" %}
{% block content %}

<!-- ================= CATEGORY HEADER ================= -->
<div class="category-header mb-5 d-flex flex-wrap justify-content-between align-items-center gap-3">
  <div>
    <h2 class="category-title">Search results</h2>
    {% if search_query %}
      <p class="category-subtitle text-muted">
        Results for “{{ search_query }}”
      </p>
    {% endif %}
  </div>
</div>

<!-- ================= PRODUCT GRID ================= -->
<div class="row g-4">
  {% for product in products %}
  <div class="col-xl-3 col-lg-4 col-md-6">
    <div class="card h-100 border-0 position-relative overflow-hidden">

      {% if product.photo %}
      <img
        src="{{ product.photo.url }}"
        class="card-img-top"
        alt="{{ product.name }}"
      >
      {% else %}
      <div class="card-img-top placeholder-img d-flex align-items-center justify-content-center text-muted">
        No Image
      </div>
      {% endif %}

      <div class="card-body d-flex flex-column p-3">

        <!-- PRODUCT NAME -->
        <h5 class="product-title text-truncate" title="{{ product.name }}">
          {{ product.name }}
        </h5>

        <!-- DESCRIPTION -->
        <p class="product-desc">
          {{ product.description|truncatechars:80 }}
        </p>

        <!-- PRICE -->
        <div class="mb-2">
          <span class="product-price">${{ product.price }}</span>
        </div>

        <!-- STATUS BADGES -->
        <div class="mb-3 d-flex flex-wrap gap-1">
          {% if product.cached_quantity == 0 %}
            <span class="badge bg-danger-subtle text-danger">Out of stock</span>
          {% elif product.cached_quantity <= 10 %}
            <span class="badge bg-warning-subtle text-warning">Low stock</span>
          {% else %}
            <span class="badge bg-success-subtle text-success">In stock</span>
          {% endif %}

          {% if request.user.is_staff %}
            {% if not product.is_active %}
              <span class="badge bg-secondary-subtle text-secondary">Archived</span>
            {% else %}
              <span class="badge bg-primary-subtle text-primary">Active</span>
            {% endif %}
          {% endif %}
        </div>

        {% if request.user.is_staff %}
          <div class="mb-2">
            <a href="{% url 'product_edit' product.id %}"
               class="btn btn-sm btn-outline-secondary w-100">
              Edit
            </a>
          </div>
        {% endif %}

        <div class="mt-auto"></div>

        <!-- ADD TO CART -->
        {% if product.cached_quantity > 0 %}
          <form class="add-to-cart-form"
                data-product-id="{{ product.id }}"
                onsubmit="return false;">
            {% csrf_token %}
            <button type="button"
                    class="btn btn-primary w-100 add-to-cart-btn">
              Add to Cart
            </button>
          </form>
        {% else %}
          <button class="btn btn-secondary w-100" disabled>
            Unavailable
          </button>
        {% endif %}

      </div>
    </div>
  </div>
  {% empty %}
    <div class="col-12 text-center py-5">
      <p class="text-muted mb-0">No products found matching your search.</p>
    </div>
  {% endfor %}
</div>

<!-- ================= STYLES ================= -->
<style>
:root {
  --primary: #2563eb;
  --primary-dark: #1e40af;
  --bg-main: #f8fafc;
  --card-bg: #ffffff;
  --text-main: #0f172a;
  --text-muted: #64748b;
  --radius-lg: 16px;
  --radius-pill: 999px;
}

/* CATEGORY HEADER */
.category-header {
  background: var(--card-bg);
  padding: 18px 24px;
  border-radius: var(--radius-lg);
  box-shadow: 0 10px 25px rgba(0,0,0,.08);
  transition: box-shadow .3s ease;
}
.category-header:hover {
  box-shadow: 0 14px 35px rgba(0,0,0,.12);
}
.category-title {
  font-weight: 700;
  font-size: 1.5rem;
  color: var(--text-main);
  margin-bottom: 0;
}
.category-subtitle {
  font-size: .9rem;
  color: var(--text-muted);
  margin-top: .25rem;
}

/* CARD */
.card {
  border-radius: var(--radius-lg);
  background: var(--card-bg);
  transition: transform .25s ease, box-shadow .25s ease;
  box-shadow: 0 12px 30px rgba(0,0,0,.07);
  display: flex;
  flex-direction: column;
}
.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 28px 60px rgba(0,0,0,.15);
}

/* IMAGE */
.card-img-top {
  height: 200px;
  object-fit: cover;
  border-top-left-radius: var(--radius-lg);
  border-top-right-radius: var(--radius-lg);
}
.placeholder-img {
  height: 200px;
  background: #f0f2f5;
  font-size: 0.9rem;
  border-top-left-radius: var(--radius-lg);
  border-top-right-radius: var(--radius-lg);
}

/* PRODUCT TEXT */
.product-title {
  font-weight: 600;
  font-size: 1rem;
  color: var(--text-main);
  margin-bottom: 6px;
}
.product-desc {
  font-size: .875rem;
  color: var(--text-muted);
  margin-bottom: 10px;
  min-height: 40px;
}

/* PRICE */
.product-price {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--primary-dark);
}

/* BADGES */
.badge {
  font-size: .75rem;
  font-weight: 600;
  border-radius: var(--radius-pill);
  padding: 6px 14px;
  letter-spacing: .5px;
  text-transform: uppercase;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: transform .2s ease, box-shadow .2s ease, background .3s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}
.bg-success-subtle { background: linear-gradient(135deg, #d1fae5, #10b98133); color: #047857; }
.bg-warning-subtle { background: linear-gradient(135deg, #fef3c7, #f59e0b33); color: #b45309; }
.bg-danger-subtle { background: linear-gradient(135deg, #fee2e2, #ef444433); color: #b91c1c; }
.bg-primary-subtle { background: linear-gradient(135deg, #dbeafe, #3b82f633); color: #1e40af; }
.bg-secondary-subtle { background: linear-gradient(135deg, #e5e7eb, #6b728033); color: #374151; }
.badge:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,.12); }

/* ADD TO CART */
.add-to-cart-btn {
  font-weight: 600;
  letter-spacing: .3px;
  transition: background .2s ease, transform .15s ease;
}
.add-to-cart-btn:hover { background-color: var(--primary-dark); transform: translateY(-2px); }

/* BUTTONS */
.btn-outline-primary {
  transition: all .2s ease;
}
.btn-outline-primary:hover { background-color: var(--primary); color: #fff; border-color: var(--primary); }
</style>

{% endblock %}
